<canvas id="textur" width="1566" height="744"></canvas>
<input type="text" id="message" placeholder="message">
<button type="button" id="submit" onclick="submit()" name="button">send</button>

<script>

  window.onbeforeunload = function() {
    console.log("Leave Website");
    sendJson('/strategoChars/logout', {
      clientId
    });
    return 'Are you sure you want to leave?';
  };

var links = {pictures: {bomb: "http://adi.nicolaiweitkemper.de/Bilder/bomb.png", redFlag: "http://adi.nicolaiweitkemper.de/Bilder/redFlag.png", blueFlag: "http://adi.nicolaiweitkemper.de/Bilder/blueFlag.png"}, sounds: {march: "http://adi.nicolaiweitkemper.de/Sounds/GERMAN%20TROOPS%20MARCH%20INTO%20RHINELAND%20-%20SOUND.mp3", swardFight: "http://soundbible.com/mp3/rage_of_blades-Blaga_Saun-1763516257.mp3", badLaugh: "http://soundbible.com/mp3/Jolly%20Laugh-SoundBible.com-874430997.mp3", crying: "http://soundbible.com/mp3/woman-crying-daniel_simon.mp3"}}
var Bild = new Image();
var canvas = document.getElementById('textur').getContext('2d'); //Dimension
var roundStatus = ["none"];
var koordinaten = [];
var myId;
var opponentId;
var idsBleibt = [];
var typed = "";
var audio;
var colorsModes = {normal: ["#BC750A", "green"], special: ["green", "yellow"]}
var colors = colorsModes.normal
var playerMoved = [false];
var xMaus = 0;
var yMaus = 0;
var hinzufügenX = 0;
var hinzufügenY = 0;
var mins;
var secs;
var tenths;
var message = {sniper: "Der Sniper hat wenig leben, macht jedoch bei großer Entfenung zum Gegner viel Schaden. Um dies zu ermöglichen, ist die Reichweite natürlich auch hoch. Also: je weiter entfernt vom Ziel, desto besser!", disperser: "Der Disperser macht aus der Nähe viel Schaden und hat zudem eine durchschnittliche Anzahl an leben. Leider ist seine Reichweite gering. Deshalb ist es wichtig, möglichst nah an den Gegner ran zu kommen!", tank: "Der Tank hat viele Leben. Dafür macht er wenig Schaden. Die Reichweite ist durchschnittlich.", zerstreuer: "Der Zerstreuer verteilt seine Kugeln auch auf Felder neben sich. Deshalb macht er pro Gegner geringen Schaden. Die Reichweite ist leicht unterdurchschnittlich, wobei die Entfernung zum Gegner keine Rolle spielt.", loader: "der Loader kann, wie der Name schon sagt seine Waffe aufladen (statt schießen), um später mehrere Salven abfeuern zu können. Die Leben sind durchschnittlich. Maximal kann die Waffe 4 Mal ohne Abschuss geladen werden. Die Reichweite ist hoch, um die volle Power gut nutzen zu können."}
var player = {bomb: {lives: 100, damage: 55, anzahl: 3}, flag: {lives: 500, damage: 17, anzahl: 1}, entschärfer: {lives: 170, damage: 55, radius: 3, streuung: 1, loaded: 1, anzahl: 2} ,sniper: {lives: 200, damagePerField: {higher: "away", damage: 50}, radius: 3, streuung: 1, loaded: 1, anzahl: 2}, zerstreuer: {lives: 277, damage: 33, radius: 2, streuung: 2, loaded: 1, anzahl: 1}, tank: {lives: 555, damage: 55, radius: 2, streuung: 1, loaded: 1, anzahl: 1}, disperser: {lives: 355,damagePerField: {higher: "near", damage: 44}, radius:2, streuung: 1, loaded: 1, anzahl: 2},loader: {lives: 300, damage/*PerShot*/: 40, radius: 2, streuung: 1, maxLoaded: 4, loaded: 0, anzahl: 1}};
var spielfeld = [];
    spielfeld[0] = [["land", 5]];
    spielfeld[1] = [["land", 5]];
    spielfeld[2] = [["land", 4], ["water", 1]];
    spielfeld[3] = [["land", 4], ["water", 1]];
    spielfeld[4] = [["land", 5]];

// 1/4 (type, wie oft von links nach rechts)
var AblageListe = [];
    AblageListe[0] = [];
var zählerListe = [];
var messages = [];
var viewingMessages = false;

// Ausschreiben
for (var i = 0; i < spielfeld.length; i++) {
  AblageListe[0][i] = [];
  for (var i1 = 0; i1 < spielfeld[i].length; i1++) {
    for (var i2 = 0; i2 < spielfeld[i][i1][1]; i2++) {
      AblageListe[0][i][AblageListe[0][i].length] = {type: spielfeld[i][i1][0], player: false};
      // AblageListe[0][i].push(spielfeld[i][i1][0]);
    }
  }
}
// Spieglung nach unten
for (var i = spielfeld.length - 1; i > -1; i--) {
  AblageListe[0].push(AblageListe[0][i]);
}
spielfeld = JSON.parse(JSON.stringify(AblageListe[0]));
// Spieglung nach rechts
for (var i = 0; i < spielfeld.length - 5; i++) {
//  console.log(AblageListe[0]);
  for (var i1 = spielfeld[i].length - 1; i1 > -1; i1--) {
    AblageListe[0][i].push(spielfeld[i][i1]);
  }
}
console.log(AblageListe[0]);
spielfeld = JSON.parse(JSON.stringify(AblageListe[0]));

  async function sendJson(url = "/", body = {}) {
    const rawResponse = await fetch(url, {
      method: 'POST',
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(body)
    });
    const content = await rawResponse.json();
    return content;
  }
  // sendJson('/logout', {
  //   clientId
  // });

  const clientId = makeid(10);
  var messageListener = null;

  async function register() {
    let response = sendJson('/strategoChars/login', {
      clientId
    });
  }

  register();
  setInterval(getMessages, 3000);

  function getMessages() {
    sendJson('/strategoChars/message-queue', {
      clientId
    }).then(messages => {
      if (messages.length > 0) {
        console.log("MESSAGES", messages);
      }
      messages.forEach(msg => messageListener(msg));
    });
  }

  function sendMessage(obj) {
    sendJson('/strategoChars/message', {
      clientId,
      content: obj
    });
  }

  function makeid(length) {
    var result = '';
    var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    var charactersLength = characters.length;
    for (var i = 0; i < length; i++) {
      result += characters.charAt(Math.floor(Math.random() * charactersLength));
    }
    return result;
  }


  var room = {
    setOnMessageListener(listener) {
      messageListener = listener;
    },
    send(msg) {
      sendMessage(msg);
    }
  };


  // listen to patches coming from the server
  room.setOnMessageListener(function(message) {
    if (message.type == "messages") {
      messages = message.data

      textur.height = 777 + messages.length*44;
      Layout(false);
      if (!(myId == message.sender)) audio = new Audio("https://adi.nicolaiweitkemper.de/Sounds/ding-sound-effect-youtubemp3free.org.mp3").play();
      AblageListe[1] = "warten Message angucken";
      setTimeout(function () {
        AblageListe[1] = "beendet";
      }, 3777);
    };
    if (message.type == "gewonnen") showResults(message.data, 0, message.siegDurch);
    if (message.type == "player1") {myId = idsBleibt[0]; opponentId = idsBleibt[1];}
    if (message.type == "player2") {myId = idsBleibt[1]; opponentId = idsBleibt[0];}
    if (message.type == "onLeave") idsBleibt = [];
    if (message.type == "playerMoved" && myId == ids[1]) {
      playerMoved = [true, message.data[0], message.data[1]];
      // canvas.fillStyle = colors[1];
      // canvas.fillRect(477 + 70*message.data[0], 17 + 70*message.data[1], 60, 60);
      audio = new Audio(links.sounds.march);
      audio.currentTime = 50;
      audio.play();
      setTimeout(function () {
        audio.pause();
      }, 333);
      Layout(false);
    }
    if (message.type == "spielerIds")    {
       ids = message.data;
      if (idsBleibt.length == 0)  idsBleibt = JSON.parse(JSON.stringify(ids));
  //    if (playerMe == 1) myId = idsBleibt[0]
  //    if (playerMe == 2) myId = idsBleibt[1]
    }
    if (message.type == "spielfeldBottom") {
      for (var i = 0; i < spielfeld.length; i++) {
        for (var i1 = 6; i1 < spielfeld.length; i1++) {
          spielfeld[i][i1] = message.data[i][i1];
        }
      }
    }
    if (message.type == "spielfeldTop") {
      for (var i = 0; i < spielfeld.length; i++) {
      for (var i1 = 0; i1 < 4; i1++) {
        spielfeld[i][i1] = message.data[i][i1];
      }
    }
    }
    if (message.type == "spielfeld")  {
      if (!(myId == message.idSender))  spielfeld = message.data;
  //    if (!(roundStatus[0] == "showRewardsAttack"))  Layout(false);
      }
    if (message.type == "roundStatus"/* && myId == ids[1]*/) {
      // for (var i = 0; i < message.data.length; i++) {
      //   roundStatus[i] = message.data[i];
      // }
    //  Layout(false);
    roundStatus = message.data;
    }
    if (message.type == "showNumber"/* && myId == ids[1]*/) {
      if (myId == ids[1])  canvas.fillStyle = "red";
      else canvas.fillStyle = colors[1];
      canvas.fillRect(477 + 70*message.data.oldSpot[0], 17 + 70*message.data.oldSpot[1], 60, 60);
      showIcon(message.data.oldSpot, message.data.numberOldSpot);
      if (myId == ids[1])  canvas.fillStyle = colors[1];
      else  canvas.fillStyle = "red";
      canvas.fillRect(477 + 70*message.data.newSpot[0], 17 + 70*message.data.newSpot[1], 60, 60);
      showIcon(message.data.newSpot, message.data.numberNewSpot);
      audio = new Audio(links.sounds.swardFight);
      audio.currentTime = 0;
      audio.volume = 0.5;
      audio.play();
      setTimeout(function () {
        audio.pause();
      }, 1033);
    }
    if (!(roundStatus[0] == "showRewardsAttack") && !(roundStatus[0] == "movePlayer") && !(roundStatus[0] == "playerMoved"))  Layout(false)
  });
  function showResults(gewinner, times, siegDurch) {
    if (myId == gewinner) {
      console.log("Du hast gewonnen!!!");
      if (times == 0) audio = new Audio(/*"https://soundbible.com/mp3/Ta Da-SoundBible.com-1884170640.mp3"*/"https://adi.nicolaiweitkemper.de/Sounds/old-victory-sound-roblox-youtubemp3free.org.mp3").play();
        canvas.fillStyle = "green";
        canvas.fillRect(0, 0, 1847, 973);
        Bild.src = "https://adi.nicolaiweitkemper.de/Bilder/Gewinnerbildschirm.jpeg";
        canvas.drawImage(Bild, 260, 0);
    } else {
      console.log("Du hast verloren!!!");
      canvas.fillStyle = "red";
      canvas.fillRect(0, 0, 1847, 973)
      Bild.src = "https://adi.nicolaiweitkemper.de/Bilder/Verloren%20Bildschirm.jpg"
      canvas.drawImage(Bild, 260, 0);
      if (times == 0)  audio = new Audio("https://adi.nicolaiweitkemper.de/Sounds/FAIL%20SOUND%20EFFECT.mp3").play();
    }
    setTimeout(function () {
      if (times < 5) showResults(gewinner, times + 1, siegDurch);
      else if (myId == gewinner) alert("Sieg durch " + siegDurch);
    }, 500);
  }
roundStatus[0] = "placePlayer";
function submit() {
  messages.push(document.getElementById('message').value);
  room.send({
    message: {
    type: "messages",
    data: messages,
    sender: myId
  }
  });
  setTimeout(function () {
      window.scroll(scrollX, 10000)
      document.getElementById('message').select();
  }, 3000);
}
function Layout(sync, vorschau) {
  canvas.fillStyle = "#FA9B0D";
  // background colour: #FA9B0D
  canvas.fillRect(0, 0, document.getElementById('textur').width, document.getElementById('textur').height);
  AblageListe[2] = {"land": /*"#BC750A" "green"*/colors[0], "water": "#0CD6E1"}; // colours ground types
  AblageListe[1] = [];
  if (!(roundStatus[0] == "placePlayer")) {
    AblageListe[3] = [];
    AblageListe[3][0] = [];
    AblageListe[3][1] = []
    for (var i = 0; i < Object.keys(player).length; i++) {
      // AblageListe[3][0].push([Object.keys(player)[i], 0]) // .push({Object.keys(player)[i]: 0});
      // AblageListe[3][1].push([Object.keys(player)[i], 0])//({Object.keys(player)[i]: 0});
      AblageListe[3][0][Object.keys(player)[i]] = ({number: Object.keys(player)[i], anzahl: 0});
      AblageListe[3][1][Object.keys(player)[i]] = ({number: Object.keys(player)[i], anzahl: 0});
    }
  }
  // showRangeAttack:
   AblageListe[4] = [-1,-1];
  if (!(roundStatus[0] == "movePlayer" || roundStatus[0] == "shoot") && AblageListe[0].length == 2 && spielfeld[AblageListe[0][0]][AblageListe[0][1]].player.id == myId ) AblageListe[4] = AblageListe[0];
  else if (!(roundStatus[1] == undefined)) AblageListe[4] = roundStatus[1];
    roundStatus[3] = [];
  if (!(spielfeld[AblageListe[4][0]]/*[AblageListe[4][1]]*/ == undefined) && !(spielfeld[AblageListe[4][0]][AblageListe[4][1]] == undefined)  && !(spielfeld[AblageListe[4][0]][AblageListe[4][1]].player == false) /*roundStatus[0] == "movePlayer" || roundStatus[0] == "shoot"*/) {
    roundStatus[3][0] = [];
    roundStatus[3][1] = [];
    roundStatus[3][2] = [];
    roundStatus[3][3] = [];
  for (var i1 = 0; ((spielfeld[AblageListe[4][0]][AblageListe[4][1]].player.streuung == 1 && i1 < 1) || (spielfeld[AblageListe[4][0]][AblageListe[4][1]].player.streuung > 1 && i1 < spielfeld[AblageListe[4][0]][AblageListe[4][1]].player.streuung*2 - 1)); i1++) {
  if (!((i1/2 + "").includes(".")) && i1 > 0) i1 = (i1 - 1)*(-1);
  for (var i = 1; i < spielfeld[AblageListe[4][0]][AblageListe[4][1]].player.radius + 1; i++) { // right
//    console.log([AblageListe[4][0] + 1*i, AblageListe[4][1] + i1]);
    roundStatus[3][2].push([AblageListe[4][0] + 1*i, AblageListe[4][1] + i1]);
  }
  for (var i = 1; i < spielfeld[AblageListe[4][0]][AblageListe[4][1]].player.radius + 1; i++) { // left
//    console.log([AblageListe[4][0] - 1*i, AblageListe[4][1] + i1]);
    roundStatus[3][0].push([AblageListe[4][0] - 1*i, AblageListe[4][1] + i1]);
  }
  for (var i = 1; i < spielfeld[AblageListe[4][0]][AblageListe[4][1]].player.radius + 1; i++) { // down
//    console.log([AblageListe[4][0] + i1, AblageListe[4][1] + 1*i]);
    roundStatus[3][3].push([AblageListe[4][0] + i1, AblageListe[4][1] + 1*i]);
  }
  for (var i = 1; i < spielfeld[AblageListe[4][0]][AblageListe[4][1]].player.radius + 1; i++) { // up
  //  console.log([AblageListe[4][0] + i1, AblageListe[4][1] - 1*i]);
    roundStatus[3][1].push([AblageListe[4][0] + i1, AblageListe[4][1] - 1*i]);
  }
  if (i1 < 0) i1 = (i1)*(-1) + 1
}
}
  for (var i1 = 0; i1 < spielfeld.length; i1++) {
    for (var i = 0; i < spielfeld.length; i++) {
      if (!(spielfeld[i][i1].player == false) && !(spielfeld[i][i1].player.vorschau == undefined)) {
        if (spielfeld[i][i1].player.vorschau > 2) spielfeld[i][i1].player = false;
        spielfeld[i][i1].player.vorschau++;
      }
      if (!(spielfeld[i][i1].player == false) && spielfeld[i][i1].player.livesNow < 1 && ids[0] == myId) {
        if (spielfeld[i][i1].player.number == "flag" && !(spielfeld[i][i1].player.id == myId)) {
              room.send({
                message: {
                  type: "gewonnen",
                  data: myId,
                  siegDurch: "Niederlage"
                }
          //    }
              });
        }
        spielfeld[i][i1].player = false;
      }
      if (roundStatus[0] == "movePlayer" && i == roundStatus[1][0] && i1 == roundStatus[1][1]) {
        canvas.fillStyle = "#FC2600";
        canvas.fillRect(477 + 70*roundStatus[1][0] - 10, 17 + 70*roundStatus[1][1] - 10, 80, 80);
      }
    canvas.fillStyle = AblageListe[2][spielfeld[i][i1].type];
    if (!(spielfeld[i][i1].player == false)) {
      if (true/*spielfeld[i][i1].player.id == myId*/  /* || (roundStatus[0] == "movePlayer" && roundStatus[1][0] == i && roundStatus[1][1] == i1)*/) {
      if (roundStatus[0] == "showRewardsAttack" && roundStatus[1][0] == i && roundStatus[1][1] == i1) {
        canvas.fillStyle = "#FC2600";
      }
      else {
        if (spielfeld[i][i1].player.id == myId) canvas.fillStyle = "blue";
        else canvas.fillStyle = "red";
      }
      AblageListe[1].push([i, i1]);
      // setTimeout(function () {
        if (AblageListe[1].length > 0/* && (spielfeld[AblageListe[1][0][0]][AblageListe[1][0][1]].player.number == 0 || spielfeld[AblageListe[1][0][0]][AblageListe[1][0][1]].player.number == 11)*/) {
          // setTimeout(function () {
          //   if (loadPicture == false) {
          //   Layout(true)true);
          // }
          // }, 100);
        showIcon(AblageListe[1][0], spielfeld[AblageListe[1][0][0]][AblageListe[1][0][1]].player.number, i, i1);
        AblageListe[1].shift();
    }
    // }, 10);
  }
    else canvas.fillStyle = "#FC2600";
  }
    else if (!(spielfeld[i][i1].player == false))  canvas.fillStyle = "#FC2600";
    if (vorschau == "vorschau" && i == AblageListe[4][0] && i1 == AblageListe[4][1]) canvas.fillStyle = "rgba(0, 0, 255, 0.5)";
    canvas.fillRect(477 + 70*i, 17 + 70*i1, 60, 60);
    if (!(roundStatus[0] == "placePlayer") && !(spielfeld[i][i1].player == false) && spielfeld[i][i1].player.id == myId) {
      AblageListe[3][0][spielfeld[i][i1].player.number].anzahl++;
      // for (var i2 = 0; i2 < AblageListe[3][0].length; i2++) {
      //   if (AblageListe[3][0][i] == spielfeld[i][i1].player.number)  AblageListe[3][0][i][1]++;
      // }
    }
    else if (!(roundStatus[0] == "placePlayer") && !(spielfeld[i][i1].player == false)) {
      // for (var i2 = 0; i2 < AblageListe[3][1].length; i2++) {
      //   if (AblageListe[3][1][i][0] == spielfeld[i][i1].player.number)  AblageListe[3][1][i][1]++;
      // }
      AblageListe[3][1][spielfeld[i][i1].player.number].anzahl++;
    }
    if (/*roundStatus[0] == "movePlayer" || roundStatus[0] == "shoot"*/roundStatus[3].length > 0) {
    for (var i4 = 0; i4 < 4; i4++) {
    for (var i3 = 0; i3 < roundStatus[3][i4].length; i3++) {
      if (roundStatus[3][i4][i3][0] == i && roundStatus[3][i4][i3][1] == i1) {
        canvas.fillStyle = "rgba(128, 128, 128, 0.5)";
        canvas.fillRect(477 + 70*i, 17 + 70*i1, 60, 60);
      }
    }
  }
}
  }
  }
  if (playerMoved[0] == true) {
    canvas.fillStyle = colors[1];
    canvas.fillRect(477 + 70*playerMoved[1], 17 + 70*playerMoved[2], 60, 60);
  }
  koordinaten[2] = 0;
  AblageListe[4] = player;
  if (!(roundStatus[0] == "placePlayer")) player = AblageListe[3][0];
  showStats();
  koordinaten[2] = 1290;
  if (!(roundStatus[0] == "placePlayer")) player = AblageListe[3][1];
  if (!(roundStatus[0] == "placePlayer")) showStats();
  player = AblageListe[4]
  if (sync == true && !(roundStatus[0] == "showRewardsAttack")) {
    syncData();
  }
    Bild = new Image();
    Bild.src = "http://adi.nicolaiweitkemper.de/Bilder/whiteFlag.png";
    canvas.drawImage(Bild, 222, 244, 100, 100);
  showChat();
}
function showChat() {
  for (var i = 0; i < messages.length; i++) {
    // if (!(messages[messages.length - 1 - i] == undefined)) {
    canvas.fillStyle = "white";
    canvas.font = "33px Georgia";
    canvas.fillText(messages[messages.length - 1 - i], 33, 788 + 44*i);
  }
  }
function showIcon(coordinates, number, i, i1) {
  setTimeout(function () {
  Bild = new Image();
  if (number == "flag") {
  if (spielfeld[coordinates[0]][coordinates[1]].player.id == myId || ((i == playerMoved[1] || i == playerMoved[3]) && (i1 == playerMoved[2] || i1 == playerMoved[4])))  Bild.src = links.pictures["blueFlag"];
  else Bild.src = links.pictures["redFlag"];
    if (spielfeld[i][i1].player.id == myId || (i == playerMoved[1] || i == playerMoved[3]) && (i1 == playerMoved[2] || i == playerMoved[4])) canvas.drawImage(Bild, 477 + 70*coordinates[0], 17 + 70*coordinates[1], 60, 60)
  }
  else if (number == "bomb" && (spielfeld[i][i1].player.id == myId || (i == playerMoved[1] || i == playerMoved[3]) && (i1 == playerMoved[2] || i1 == playerMoved[4]))) {
    Bild.src = links.pictures["bomb"];
    canvas.drawImage(Bild, 477 + 70*coordinates[0], 17 + 70*coordinates[1], 60, 60)
  }
  else {
    canvas.fillStyle = "white";
    canvas.font = "37px Georgia";
    if (spielfeld[i][i1].player.id == myId || ((i == playerMoved[1] || i == playerMoved[3]) && (i1 == playerMoved[2] || i1 == playerMoved[4]))) canvas.fillText(number[0], 477 + 70*coordinates[0] + 22, 17 + 70*coordinates[1] + 40);
  }
  //  showHealth:
      canvas.fillStyle = "white";
      canvas.fillRect(477 + 70*coordinates[0], 17 + 70*coordinates[1] + 5 - 5, 60, 10);
      canvas.fillStyle = "blue";
      canvas.fillRect(477 + 70*coordinates[0] + 3, 17 + 70*coordinates[1] + 5 - 2, 60 - 6, 3);
      canvas.fillStyle = "red";
      canvas.fillRect(477 + 70*coordinates[0] + 3, 17 + 70*coordinates[1] + 5 - 2, (60 - 6)*((spielfeld[i][i1].player.livesNow/spielfeld[i][i1].player.lives)), 3);
      AblageListe[1].shift();
  }, 10);
}
function syncData() {
  room.send({
    message: {
      "type": "spielfeld",
      "data": spielfeld,
      "idSender": myId
    }
  });
}

function showStats() {
  koordinaten[1] = 37;
  koordinaten[0] = 17;
  canvas.fillStyle = "white";
  canvas.font = "47px Georgia";
  if (!(roundStatus[0] == "placePlayer")) {
    canvas.fillText("your remainings", 17, 37);
    canvas.font = "43px Georgia";
    canvas.fillText("opponents remainings", 1177, 37);
    if (ids[0] == myId) canvas.fillStyle = '#3ADF00';
    else canvas.fillStyle = 'red';
    canvas.beginPath();
    canvas.arc(373, 34, 30, 0, Math.PI * 2, false);
    canvas.fill();
    canvas.fillStyle = "white";
  }
  else {
    canvas.fillText("remaining to place", 17, 37);
  //  player.push();
  }

  canvas.font = "43px Georgia";
  canvas.fillText("starken Kontrast", 170, 179);
  if (colors[0] == "#BC750A")  canvas.fillText("aktivieren", 170, 230);
  else canvas.fillText("deaktivieren", 170, 230);
  if (!(myId == undefined) && myId == idsBleibt[0]) canvas.fillText("your side: bottom", 157, 97);
  else if (!(myId == undefined)) canvas.fillText("your side: top", 157, 97);
//  ( && AblageListe[0][1] > 5) || (myId == idsBleibt[1] && AblageListe[0][1] < 4)
  canvas.font = "37px Georgia";
  for (var i = 0; i < Object.keys(player).length/* - 1*/; i++) {
    for (var i1 = 0; i < 7 &&(player[Object.keys(player)[i]].anzahl < 1 && !(i == Object.keys(player).length)); i++) {
      koordinaten[1] += 94;
      if (i == 6) {
        koordinaten[0] += 222;
        koordinaten[1] = 333;
      }
    }
    if (!(roundStatus[1] == undefined) && Object.keys(player)[i] == roundStatus[1])  canvas.fillStyle = "#FC2600";
    else canvas.fillStyle = "white";
  // if (i == 0) {
  //   canvas.fillText("flag", koordinaten[0] + koordinaten[2], koordinaten[1] + 50)
  // }
  // else if (i == 10) {
  //   canvas.fillText(i, koordinaten[0] + koordinaten[2], koordinaten[1] + 50)
  // }
  // else if (i == 11) {
  //   canvas.fillText("bomb", koordinaten[0] + koordinaten[2] - 13, koordinaten[1] + 50)
  // }
  // else if (i == 12) {
  //   canvas.fillText("delete", koordinaten[0] + koordinaten[2] - 13, koordinaten[1] + 50)
  // }
  // else {
    canvas.fillText(Object.keys(player)[i], koordinaten[0] + koordinaten[2] + 13, koordinaten[1] + 50)
//  }
  koordinaten[1] += 37;
  if (!(i == 12)) canvas.fillText(player[Object.keys(player)[i]].anzahl + "X", koordinaten[0] + koordinaten[2], koordinaten[1] + 50)
  koordinaten[1] += 57;
  if (i == 6) {
    koordinaten[0] += 222;
    koordinaten[1]= 333;
  }
}
//player.pop();
}

// function attack() {
  // spielfeld[roundStatus[3][0]][roundStatus[3][1]].player = false; playerMoved[0] = false;//roundStatus[0] = "ingame";
  // canvas.fillStyle = colors[0];
  // canvas.fillRect(477 + 70*roundStatus[3][0], 17 + 70*roundStatus[3][1], 60, 60);
  // if (roundStatus[2][0] == 11 && roundStatus[2][1] == 3) {
  //   console.log("won");
  //   spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.number = 3;
  //   spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.id = JSON.parse(JSON.stringify(roundStatus[4][0]));
  //   if (myId == roundStatus[4][0]) audio = new Audio(links.sounds.badLaugh).play();
  //   else {
  //     audio = new Audio(links.sounds.crying);
  //     audio.currentTime = 10;
  //   audio.play();
  //   setTimeout(function () {
  //   audio.pause();
  //   }, 1333);
  //   }
  // }
  // else if (roundStatus[2][0] == 1 && roundStatus[2][1] == 10) {
  //   console.log("lost");
  //   if (myId == roundStatus[4][1]) audio = new Audio(links.sounds.badLaugh).play();
  //   else {
  //     audio = new Audio(links.sounds.crying);
  //     audio.currentTime = 10;
  //   audio.play();
  //   setTimeout(function () {
  //   audio.pause();
  //   }, 1333);
  //   }
  // }
  // else if (roundStatus[2][1] == 1 && roundStatus[2][0] == 10) {
  //   console.log("won");
  //   spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.number = 1;
  //   spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.id = JSON.parse(JSON.stringify(roundStatus[4][0]));
  //   if (myId == roundStatus[4][0]) audio = new Audio(links.sounds.badLaugh).play();
  //   else {
  //     audio = new Audio(links.sounds.crying);
  //     audio.currentTime = 10;
  //   audio.play();
  //   setTimeout(function () {
  //   audio.pause();
  //   }, 1333);
  //   }
  // }
  // else if (roundStatus[2][0] < roundStatus[2][1]) {
  //   console.log("won");
  //   if (roundStatus[2][0] == 0 && ids[0] == myId) {
  //     room.send({
  //       message: {
  //         type: "gewonnen",
  //         data: myId,
  //         siegDurch: "Niederlage"
  //       }
  // //    }
  //     });
  //   }
  //   spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.number = JSON.parse(JSON.stringify(roundStatus[2][1]));
  //   spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.id = JSON.parse(JSON.stringify(roundStatus[4][0]));
  //   if (myId == roundStatus[4][0]) audio = new Audio(links.sounds.badLaugh).play();
  //   else {
  //     audio = new Audio(links.sounds.crying);
  //     audio.currentTime = 10;
  //   audio.play();
  //   setTimeout(function () {
  //   audio.pause();
  //   }, 1333);
  //   }
  // }
  // else if (roundStatus[2][0] > roundStatus[2][1]) {
  //   console.log("lost");
  //   spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.id = JSON.parse(JSON.stringify(roundStatus[4][1]));
  //   if (myId == roundStatus[4][1]) audio = new Audio(links.sounds.badLaugh).play();
  //   else {
  //     audio = new Audio(links.sounds.crying);
  //     audio.currentTime = 10;
  //   audio.play();
  //   setTimeout(function () {
  //   audio.pause();
  //   }, 1333);
  //   }
  // }
  // else {
  //   console.log("draw");
  //   canvas.fillRect(477 + 70*roundStatus[1][0], 17 + 70*roundStatus[1][1], 60, 60);
  //   spielfeld[roundStatus[1][0]][roundStatus[1][1]].player = false; playerMoved[0] = false;
  //   audio = new Audio(links.sounds.crying);
  //   audio.currentTime = 10;
  //   audio.play();
  //   setTimeout(function () {
  //     audio.pause();
  //   }, 1333);
  // }
  // roundStatus[0] = "ingame";
  // Layout(false);
  // if (myId == idsBleibt[0]) {
  //   room.send({
  //     message: "Spielerwechsel"
  //   });
  //   ids = "inProgress";
  // }
//}
window.addEventListener("dblclick", dbClick)

function dbClick() {
  if (viewingMessages == false) {window.scroll(scrollX, 742); viewingMessages = true;}
  else {window.scroll(scrollX, 0); viewingMessages = false;}
  if (roundStatus[0] == "placePlayer") alert(message[roundStatus[1]] + " Nachdem die Kugel jemanden getroffen hat, wird sie nicht mehr weiter nach außen fliegen. Auch eigene Truppen können getroffen werden!");
}
document.onkeydown = function(event) {
  AblageListe[3] = [event.keyCode, event.key];
  // ev.touches[0]["pageX"] + mausxScroll) + " - " + (ev.touches[0]["pageY"] + mausyScroll
//  if (gerät == "PC" || (gerät == "Handy" && roundStatus[0] == "movePlayer" && spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.number == 2 && (swipeCoordinates.includes(swipeCoordinates[0] -300) || swipeCoordinates.includes(swipeCoordinates[0] +300) || swipeCoordinates.includes(swipeCoordinates[1] -300) || swipeCoordinates.includes(swipeCoordinates[1] +300))))    folgenKeyDown();
  if (event.key == "ArrowUp") window.scroll(scrollX, 0);
  if (event.key == "Enter" && !(AblageListe[1] == "beendet")) window.scroll(scrollX, 742);
    folgenKeyDown();
}

function folgenKeyDown() {
//  swipeCoordinates = [];
  typed += AblageListe[3][1]
  setTimeout(function () {
    typed = "";
  }, 2000);
  if (roundStatus[0] == "showRewardsAttack" && gerät == "PC" && (spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.number == 2 && AblageListe[3] == roundStatus[2][0])) {
    attack();
  }
  AblageListe[0] = {}
  for (var i = 0; i < Object.keys(player).length; i++) {
    AblageListe[0][Object.keys(player)[i][0]] = Object.keys(player)[i];
  }
    //if (AblageListe[3][0] == 13 && roundStatus[0] == "movePlayer" && spielfeld[roundStatus[3][0]][roundStatus[3][1]].player.number == 2) FinishRound();
    if (typed.includes("10")) {
      roundStatus[1] = 10;
      console.log(roundStatus[1]);
    }
    if (!(player[AblageListe[0][event.key]] == undefined) && player[AblageListe[0][event.key]].anzahl > 0) roundStatus[1] = AblageListe[0][event.key];
    // if (roundStatus[0] == "placePlayer" && AblageListe[3][0] > 48 && AblageListe[3][0] < 58 && player[Object.keys(player)[[AblageListe[3][0] - 48]]].anzahl > 0) {
    //   roundStatus[1] = AblageListe[3][0] - 48;
    //   console.log(roundStatus[1]);
    // }
    // if (roundStatus[0] == "placePlayer" && AblageListe[3][0] == 66 && player.bomb.anzahl > 0) {
    //   roundStatus[1] = "bomb"//11;
    // }
    // if (roundStatus[0] == "placePlayer" && AblageListe[3][0] == 68) {
    //   roundStatus[1] = 12;
    // }
    // if (roundStatus[0] == "placePlayer" && AblageListe[3][0] == 70 && player.flag.anzahl > 0) {
    //   roundStatus[1] = "flag";
    // }
    roundStatus[2] = JSON.parse(JSON.stringify(roundStatus[1]));
    if (roundStatus[0] == "movePlayer" && AblageListe[3][0] == 37 && roundStatus[1][0] - 1 > -1 && spielfeld[roundStatus[1][0] - 1][roundStatus[1][1]].type == "land" && (spielfeld[roundStatus[1][0] - 1][roundStatus[1][1]].player == false /*|| !(spielfeld[roundStatus[1][0] - 1][roundStatus[1][1]].player.id == myId)*/)) {  // left
      // attack
  //    if (!(spielfeld[roundStatus[1][0] - 1][roundStatus[1][1]].player.id == myId) && !(spielfeld[roundStatus[1][0] - 1][roundStatus[1][1]].player == false)) {
        roundStatus[1][0]--;
        roundStatus[0] = "finished";
  //    }
    }
    if (roundStatus[0] == "movePlayer" && AblageListe[3][0] == 38 && roundStatus[1][1] - 1 > -1 && spielfeld[roundStatus[1][0]][roundStatus[1][1] - 1].type == "land" && (spielfeld[roundStatus[1][0]][roundStatus[1][1] - 1].player == false /*|| !(spielfeld[roundStatus[1][0]][roundStatus[1][1] - 1].player.id == myId)*/)) {  // up
      // attack
  //    if (!(spielfeld[roundStatus[1][0]][roundStatus[1][1] - 1].player.id == myId) && !(spielfeld[roundStatus[1][0]][roundStatus[1][1] - 1].player == false)) {
        roundStatus[1][1]--;
        roundStatus[0] = "finished";
  //    }
    }
    if (roundStatus[0] == "movePlayer" && AblageListe[3][0] == 39 && roundStatus[1][0] - 1 < spielfeld.length && spielfeld[roundStatus[1][0] + 1][roundStatus[1][1]].type == "land" && (spielfeld[roundStatus[1][0] + 1][roundStatus[1][1]].player == false/* || !(spielfeld[roundStatus[1][0] + 1][roundStatus[1][1]].player.id == myId)*/)) {  // right
      // attack
    //  if ( !(spielfeld[roundStatus[1][0] + 1][roundStatus[1][1]].player.id == myId) && !(spielfeld[roundStatus[1][0] + 1][roundStatus[1][1]].player == false)) {
        roundStatus[1][0]++;
        roundStatus[0] = "finished";
    //  }
    }
    if (roundStatus[0] == "movePlayer" && AblageListe[3][0] == 40 && roundStatus[1][1] + 1 < spielfeld.length && spielfeld[roundStatus[1][0]][roundStatus[1][1] + 1].type == "land" && (spielfeld[roundStatus[1][0]][roundStatus[1][1] + 1].player == false/* || !(spielfeld[roundStatus[1][0]][roundStatus[1][1] + 1].player.id == myId)*/)) {  // down
      // attack
    //  if (!(spielfeld[roundStatus[1][0]][roundStatus[1][1] + 1].player.id == myId) && !(spielfeld[roundStatus[1][0]][roundStatus[1][1] + 1].player == false))
        roundStatus[1][1]++;
        roundStatus[0] = "finished";
  //    }
      }
    //   if (roundStatus[0] == "shoot" && AblageListe[3][0] == 37 && roundStatus[1][0] - 1 > -1 && spielfeld[roundStatus[1][0] - 1][roundStatus[1][1]].type == "land" && (spielfeld[roundStatus[1][0] - 1][roundStatus[1][1]].player == false /*|| !(spielfeld[roundStatus[1][0] - 1][roundStatus[1][1]].player.id == myId)*/)) {  // left
    //     // attack
    // //    if (!(spielfeld[roundStatus[1][0] - 1][roundStatus[1][1]].player.id == myId) && !(spielfeld[roundStatus[1][0] - 1][roundStatus[1][1]].player == false)) {
    //       roundStatus[1][0]--;
    //       roundStatus[0] = "shootFinished";
    // //    }
    //   }
    //   if (roundStatus[0] == "shoot" && AblageListe[3][0] == 38 && roundStatus[1][1] - 1 > -1 && spielfeld[roundStatus[1][0]][roundStatus[1][1] - 1].type == "land" && (spielfeld[roundStatus[1][0]][roundStatus[1][1] - 1].player == false /*|| !(spielfeld[roundStatus[1][0]][roundStatus[1][1] - 1].player.id == myId)*/)) {  // up
    //     // attack
    // //    if (!(spielfeld[roundStatus[1][0]][roundStatus[1][1] - 1].player.id == myId) && !(spielfeld[roundStatus[1][0]][roundStatus[1][1] - 1].player == false)) {
    //       roundStatus[1][1]--;
    //       roundStatus[0] = "shootFinished";
    // //    }
    //   }
    //   if (roundStatus[0] == "shoot" && AblageListe[3][0] == 39 && roundStatus[1][0] - 1 < spielfeld.length && spielfeld[roundStatus[1][0] + 1][roundStatus[1][1]].type == "land" && (spielfeld[roundStatus[1][0] + 1][roundStatus[1][1]].player == false/* || !(spielfeld[roundStatus[1][0] + 1][roundStatus[1][1]].player.id == myId)*/)) {  // right
    //     // attack
    //   //  if ( !(spielfeld[roundStatus[1][0] + 1][roundStatus[1][1]].player.id == myId) && !(spielfeld[roundStatus[1][0] + 1][roundStatus[1][1]].player == false)) {
    //       roundStatus[1][0]++;
    //       roundStatus[0] = "shootFinished";
    //   //  }
    //   }
    //   if (roundStatus[0] == "movePlayer" && AblageListe[3][0] == 40 && roundStatus[1][1] + 1 < spielfeld.length && spielfeld[roundStatus[1][0]][roundStatus[1][1] + 1].type == "land" && (spielfeld[roundStatus[1][0]][roundStatus[1][1] + 1].player == false/* || !(spielfeld[roundStatus[1][0]][roundStatus[1][1] + 1].player.id == myId)*/)) {  // down
    //     // attack
    //   //  if (!(spielfeld[roundStatus[1][0]][roundStatus[1][1] + 1].player.id == myId) && !(spielfeld[roundStatus[1][0]][roundStatus[1][1] + 1].player == false))
    //       roundStatus[1][1]++;
    //       roundStatus[0] = "shootFinished";
    // //    }
    //     }
      if (roundStatus[0] == "finished") {
        spielfeld[roundStatus[1][0]][roundStatus[1][1]] = JSON.parse(JSON.stringify(spielfeld[roundStatus[2][0]][roundStatus[2][1]]));
        spielfeld[roundStatus[2][0]][roundStatus[2][1]].player = false;
        roundStatus[0] = "waitingForEndingMove";
          var interval = setInterval(function () {
          if (gerät == "PC" || swipeCoordinates + "" == AblageListe[6] + "") {
            clearInterval(interval);
            setTimeout(function () {
              roundStatus[0] = "shoot";
              Layout(false);
              console.log("move done");
            }, 1000);
          }
          if (gerät == "Handy") AblageListe[6] = swipeCoordinates;
        }, 10);

      }
      if (roundStatus[0] == "shoot" && AblageListe[3][0] > 36 && AblageListe[3][0] < 41) {
        console.log("shot");
        AblageListe[0] = [];
        for (var i = 0; i < roundStatus[3][AblageListe[3][0] - 37].length && (((AblageListe[3][1] == "ArrowUp" || AblageListe[3][1] == "ArrowDown") && !(AblageListe[0].includes(roundStatus[3][AblageListe[3][0] - 37][i][0]))) || ((AblageListe[3][1] == "ArrowLeft" || AblageListe[3][1] == "ArrowRight") && !(AblageListe[0].includes(roundStatus[3][AblageListe[3][0] - 37][i][1])))); i++) {
        if (!(spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player == false)) {
            playerMoved[3] = roundStatus[3][AblageListe[3][0] - 37][i][0];
            playerMoved[4] = roundStatus[3][AblageListe[3][0] - 37][i][1];
        }
        if (!(spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.number == "entschärfer") && (spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player.number == "bomb")) spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.livesNow -= spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player.damage;
        else if ((spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.number == "entschärfer") && (spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player.number == "bomb")) spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player.livesNow -= spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.damage;
        else {
        if (!(spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.damagePerField == undefined)) {
            if (spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.damagePerField.higher == "away") {
            if (AblageListe[3][1] == "ArrowUp" && !(spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player == false)) spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player.livesNow -= (spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.damagePerField.damage*(roundStatus[1][1] - roundStatus[3][AblageListe[3][0] - 37][i][1]))*spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.loaded;
            if (AblageListe[3][1] == "ArrowDown" && !(spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player == false)) spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player.livesNow -= (spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.damagePerField.damage*(roundStatus[3][AblageListe[3][0] - 37][i][1] - roundStatus[1][1]))*spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.loaded
            if (AblageListe[3][1] == "ArrowLeft" && !(spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player == false)) spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player.livesNow -= (spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.damagePerField.damage*
            (roundStatus[1][0] - roundStatus[3][AblageListe[3][0] - 37][i][0]))*spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.loaded;
            if (AblageListe[3][1] == "ArrowRight" && !(spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player == false)) spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player.livesNow -= (spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.damagePerField.damage*
            (roundStatus[1][0] - roundStatus[3][AblageListe[3][0] - 37][i][0]))*spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.loaded;
          }
          else {
            if (AblageListe[3][1] == "ArrowUp" && !(spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player == false)) spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player.livesNow -= (spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.damagePerField.damage*(spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.radius -
             ((roundStatus[1][1])-roundStatus[3][AblageListe[3][0] - 37][i][1])))*spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.loaded;
             if (AblageListe[3][1] == "ArrowDown" && !(spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player == false)) spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player.livesNow -= (spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.damagePerField.damage*(spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.radius -
              ((roundStatus[1][1])+roundStatus[3][AblageListe[3][0] - 37][i][1])))*spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.loaded;
              if (AblageListe[3][1] == "ArrowLeft" && !(spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player == false)) spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player.livesNow -= (spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.damagePerField.damage*(spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.radius -
               ((roundStatus[1][1])-roundStatus[3][AblageListe[3][0] - 37][i][1])))*spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.loaded;
               if (AblageListe[3][1] == "ArrowRight" && !(spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player == false)) spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player.livesNow -= (spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.damagePerField.damage*(spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.radius -
                ((roundStatus[1][1])+roundStatus[3][AblageListe[3][0] - 37][i][1])))*spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.loaded;
          }
        }
        else {
          if (!(spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player == false)) spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player.livesNow -= spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.damage*spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.loaded;
        }
      }
      if ((AblageListe[3][1] == "ArrowDown" || AblageListe[3][1] == "ArrowUp") && !(spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player == false)) AblageListe[0].push(roundStatus[3][AblageListe[3][0] - 37][i][0]);
      if ((AblageListe[3][1] == "ArrowRight" || AblageListe[3][1] == "ArrowLeft") && !(spielfeld[roundStatus[3][AblageListe[3][0] - 37][i][0]][roundStatus[3][AblageListe[3][0] - 37][i][1]].player == false)) AblageListe[0].push(roundStatus[3][AblageListe[3][0] - 37][i][1]);
      }
        FinishRound();
        }
        Layout(false);
  //     else {
  //       roundStatus[3][1]++;
  //     }
  //   if (roundStatus[0] == "finished" && spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.number == 2) {
  //     if ((isNaN(roundStatus[2][0])))  roundStatus[2] = [AblageListe[3][0]];
  //     if (!(isNaN(roundStatus[2][0]))) roundStatus[2][1] = JSON.parse(JSON.stringify(roundStatus[2][0]));
  //     roundStatus[2][0] = AblageListe[3][0];
  //   }
  //   AblageListe[3] = {37: 39, 38: 40, 39: 37, 40: 38}
  //   if (roundStatus[0] == "finished" && spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.number == 2 && !(roundStatus[2][0] == roundStatus[2][1] || roundStatus[2][0] == AblageListe[3][roundStatus[2][1]])) {
  //     roundStatus[0] = "finishedPlayer2";
  //   }
  //   else if (roundStatus[0] == "finished" && spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.number == 2) {
  //     roundStatus[0] = "movePlayer";
  //     Layout(true);
  //   }
  //   if ((roundStatus[0] == "finishedPlayer2" && spielfeld[roundStatus[3][0]][roundStatus[3][1]].player.number == 2) || (roundStatus[0] == "finished" && !(spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.number == 2)))  FinishRound();
  // if (roundStatus[0] == "placePlayer") {
  // //  player = AblageListe[3][0];
  //   koordinaten[2] = 0;
  //   showStats();
  // }
}
  function FinishRound() {
    Layout(true)/*;syncData()*/;roundStatus[0] = "ingame";
    room.send({
      message: {
      type: "playerMoved",
      data: roundStatus[1]
    }
    });
  room.send({
    message: "Spielerwechsel"
  });
  ids = "inProgress";
}
var time = 0;
var running = 0;

function startPause() {
if (running == 0) {
  running = 1;
  time = 0;
  increment();
}
else {
  running = 0;
  if (roundStatus[0] == "placePlayer" && tenths > 3 && !(spielfeld[AblageListe[0][0]][AblageListe[0][1]].player == false)) {
    player[spielfeld[AblageListe[0][0]][AblageListe[0][1]].player.number].anzahl++;
    spielfeld[AblageListe[0][0]][AblageListe[0][1]].player = false;
    Layout(false);
  }
}
}
function reset() {
running = 0;
timer = 0;
}
function increment() {
if (running == 1) {
setTimeout(function () {
  time++;
  mins = Math.floor(time/10/60);
  secs = Math.floor(time/10);
      secs -= 60*mins;
  tenths = time % 10;
  if (mins < 10) {
    mins = "0" + mins
  }
  if (secs < 10) {
    secs = "0" + secs;
  }
  increment();
}, 100);
}
}
  window.addEventListener('mouseup', function() {
    startPause();
  });
  window.addEventListener('mousedown', function() {
    startPause();
    checkClickedField();
  //  if (roundStatus[0] == "movePlayer" && spielfeld[AblageListe[0][0]][AblageListe[0][1]].player.number == 2 && roundStatus[1][0] == AblageListe[0][0] && roundStatus[1][1] == AblageListe[0][1]) FinishRound();
    if (!(roundStatus[1] == 12)) {
    if (roundStatus[0] == "placePlayer" && !(AblageListe[0] == "none") && !(roundStatus[1] == undefined) && player[[roundStatus[1]]].anzahl > 0 && ((myId == idsBleibt[0] && AblageListe[0][1] > 5) || (myId == idsBleibt[1] && AblageListe[0][1] < 4)) && spielfeld[AblageListe[0][0]][AblageListe[0][1]].player == false) {
      spielfeld[AblageListe[0][0]][AblageListe[0][1]].player = {id: myId, number: roundStatus[1]}
      for (var i = 0; i < Object.keys(player[roundStatus[1]]).length; i++) {
        spielfeld[AblageListe[0][0]][AblageListe[0][1]].player[Object.keys(player[roundStatus[1]])[i]] = player[roundStatus[1]][Object.keys(player[roundStatus[1]])[i]]
      }
      spielfeld[AblageListe[0][0]][AblageListe[0][1]].player.livesNow = JSON.parse(JSON.stringify(spielfeld[AblageListe[0][0]][AblageListe[0][1]].player.lives));
      player[[roundStatus[1]]].anzahl--;
      Layout(false);
    /*  syncData();*/
      AblageListe[3] = 0;
      for (var i = 0; i < Object.keys(player).length; i++) {
        if (player[Object.keys(player)[i]].anzahl < 1) AblageListe[3]++;
      }
      setTimeout(function () {
        if (AblageListe[3] == Object.keys(player).length && confirm("Sind sie mit ihrer Aufstellung zufrienden und wollen die Runde starten?")) {
          roundStatus[0] = "ingame";
          if (idsBleibt[0] == myId) {  // bottom
            room.send({
              message: {
                "type": "spielfeldBottom",
                "data": spielfeld
              }
            });
          }
          else {  // Top
            room.send({
              message: {
                "type": "spielfeldTop",
                "data": spielfeld
              }
            });
          }

        }
      }, 500);
    }
  }
  else if (!(AblageListe[0] == "none") && !(spielfeld[AblageListe[0][0]][AblageListe[0][1]].player == false)) {

    player[spielfeld[AblageListe[0][0]][AblageListe[0][1]].player.number].anzahl++;


    spielfeld[AblageListe[0][0]][AblageListe[0][1]].player = false;
    Layout(false);
  }
    if ((roundStatus[0] == "ingame" || (roundStatus[0] == "movePlayer" && !(spielfeld[AblageListe[0][0]][AblageListe[0][1]].player.number == 2))) && !(AblageListe[0] == "none") && spielfeld[AblageListe[0][0]][AblageListe[0][1]].player.id == myId /*spielfeld[AblageListe[0][0]][AblageListe[0][1]].player.number > 0 && spielfeld[AblageListe[0][0]][AblageListe[0][1]].player.number < 11 &&*/ && !(spielfeld[AblageListe[0][0]][AblageListe[0][1]].player.number == "flag" || spielfeld[AblageListe[0][0]][AblageListe[0][1]].player.number == "bomb") && ids[0] == myId) {
      roundStatus[1] = AblageListe[0];
      roundStatus[2] = "NaN";
      roundStatus[0] = "movePlayer";
      Layout(true);
    }
    if (roundStatus[0] == "showRewardsAttack") {
      attack();
    }

    // click player to place
    koordinaten[1] = 37;
    koordinaten[0] = 17;
  for (var i = [0, "first"]; i[0] < Object.keys(player).length + 1; i[0]++) {
    if (xMaus > koordinaten[0] - 1 && xMaus < koordinaten[0] + 38 && yMaus > koordinaten[1] + 50 - 27 && yMaus < koordinaten[1] + 105 && roundStatus[0] == "placePlayer") {
      console.log(i[0]);
      roundStatus[1] = Object.keys(player)[i[0]];
    }
    koordinaten[1] += 37;
  //  canvas.fillText(player[i].anzahl + "X", koordinaten[0], koordinaten[1] + 50)
  //  canvas.fillText("flag", koordinaten[0], koordinaten[1] + 50)
    koordinaten[1] += 57;
    if (i[0] == 6 && i[1] == "first") {
      koordinaten[0] += 222;
      koordinaten[1]= 222;
      i[1] = "second";
      i[0]--;
    }
    }
    if (roundStatus[0] == "placePlayer") {
    //  player = AblageListe[3][0];
      koordinaten[2] = 0;
      showStats();
    }
    if (xMaus > 178 && xMaus < 465 && yMaus > 154 && yMaus < 248) {
      if (colors[0] == "green") colors = colorsModes.normal
      else colors = colorsModes.special
      Layout(false);
      localStorage.setItem("colors", JSON.stringify(colors));
    }
    // if (roundStatus[0] == "movePlayer" && spielfeld[roundStatus[3][0]][roundStatus[3][1]].player.number == 2) {
    //   FinishRound();
    // }
    // aufgeben
    //     canvas.drawImage(Bild, 222, 300, 100, 100);
    if (xMaus > 222 && xMaus < 266 && yMaus > 244 && yMaus < 344) {
      if (confirm("Wollen sie wirklich aufgeben?")) {
        room.send({
          message: {
            type: "gewonnen",
            data: opponentId,
            siegDurch: "Aufgabe"
          }
        });
      }
    }
  });

  if (!(JSON.parse(localStorage.getItem("colors")) == null))  colors = JSON.parse(localStorage.getItem("colors"));
function checkClickedField() {
  AblageListe[0] = "none";
  for (var i = 0; i < spielfeld.length; i++) {
    for (var i1 = 0; i1 < spielfeld.length; i1++) {
      if (xMaus > 476 + 70*i && xMaus < 476 + 70*i + 60 && yMaus > 17 + 70*i1 && yMaus < 17 + 70*i1 + 60) {
        //console.log(1 + " - " + i1);
        AblageListe[0] = [i, i1];
        if (!(roundStatus[0] == "placePlayer")) Layout(false);
        if (roundStatus[0] == "shoot" && roundStatus[1] + "" == AblageListe[0] + "" && spielfeld[i][i1].player.number == "loader" && spielfeld[i][i1].player.loaded < spielfeld[i][i1].player.maxLoaded) {
          spielfeld[i][i1].player.loaded++;
          FinishRound();
        }
      }
  }
  }
}


var f = function() {
  var eventHandler = function(event) {
    //    console.log(window.scrollX + " - " + window.scrollY);
    hinzufügenX = window.scrollX;
    hinzufügenY = window.scrollY;
//    Layout(true);
  };
  window.addEventListener('scroll', eventHandler, false)
};
// canvas.fillRect(1330, 520, 200 + 18, 60);
window.addEventListener('DOMContentLoaded', f, false)
function readMouseMove(e) {
  xMaus = e.clientX + hinzufügenX;
  yMaus = e.clientY + hinzufügenY;
  //  console.log(xMaus + " - " + yMaus);
  if (roundStatus[0] == "placePlayer" && !(roundStatus[1] == undefined) && xMaus > 481 && xMaus < 1177) {
    AblageListe[5] = AblageListe[0]
    checkClickedField();
    if (gerät == "PC" && !(AblageListe[0] == "none") && !(AblageListe[5][0] == AblageListe[0][0] && AblageListe[5][1] == AblageListe[0][1]) && spielfeld[AblageListe[0][0]][AblageListe[0][1]].player == false && spielfeld[AblageListe[0][0]][AblageListe[0][1]].type == "land" && ((myId == idsBleibt[0] && AblageListe[0][1] > 5) || (myId == idsBleibt[1] && AblageListe[0][1] < 4))) {
      spielfeld[AblageListe[0][0]][AblageListe[0][1]].player = {id: myId, number: roundStatus[1], vorschau: 0}
      for (var i = 0; i < Object.keys(player[roundStatus[1]]).length; i++) {
        spielfeld[AblageListe[0][0]][AblageListe[0][1]].player[Object.keys(player[roundStatus[1]])[i]] = player[roundStatus[1]][Object.keys(player[roundStatus[1]])[i]]
      }
      spielfeld[AblageListe[0][0]][AblageListe[0][1]].player.livesNow = spielfeld[AblageListe[0][0]][AblageListe[0][1]].player.lives;
      Layout(false, "vorschau");
      setTimeout(function () {
        spielfeld[AblageListe[0][0]][AblageListe[0][1]].player = false;
      }, 10);
  }
}
}
document.onmousemove = readMouseMove

// Tranzparentz: canvas.fillStyle = "rgba(0, 0, 210, 0.5)"; (blue)

// Handy swipe direction:

document.addEventListener('touchstart', handleTouchStart, false);
document.addEventListener('touchmove', handleTouchMove, false);
// var swipeCoordinatesX = [];
// var swipeCoordinatesY = [];
var xDown = null;
var yDown = null;

function getTouches(evt) {
return evt.touches ||             // browser API
       evt.originalEvent.touches; // jQuery
}

function handleTouchStart(evt) {
  const firstTouch = getTouches(evt)[0];
  xDown = firstTouch.clientX;
  yDown = firstTouch.clientY;
};

function handleTouchMove(evt) {
  var xUp = evt.touches[0].clientX;
  var yUp = evt.touches[0].clientY;
  var xDiff = xDown - xUp;
  var yDiff = yDown - yUp;
   swipeCoordinates = [evt.touches[0].clientX, evt.touches[0].clientY];
  if ( Math.abs( xDiff ) > Math.abs( yDiff ) ) {/*most significant*/
      if ( xDiff > 0 ) {
          /* left swipe */
          AblageListe[3] = [37, "ArrowLeft"];
      } else {
          /* right swipe */
          AblageListe[3] = [39, "ArrowRight"];
      }
  } else {
      if ( yDiff > 0 ) {
          /* up swipe */
          AblageListe[3] = [38, "ArrowUp"];
      } else {
          /* down swipe */
          AblageListe[3] = [40, "ArrowDown"];
      }
  }
  AblageListe[3].push(event.type);
  if (gerät == "Handy" && roundStatus[0] == "movePlayer" && spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.number == 2 && !((Math.round(swipeCoordinates[0])/10 + "").includes(".")) || !((Math.round(swipeCoordinates[1])/10 + "").includes("."))) {
    folgenKeyDown();
  }
 if (gerät == "Handy" && !(roundStatus[0] == "movePlayer" && spielfeld[roundStatus[1][0]][roundStatus[1][1]].player.number == 2)) {
    folgenKeyDown();
  }
};

if (navigator.userAgent.match(/Android/i) ||
  navigator.userAgent.match(/webOS/i) ||
  navigator.userAgent.match(/iPhone/i) ||
  navigator.userAgent.match(/iPad/i) ||
  navigator.userAgent.match(/iPod/i) ||
  navigator.userAgent.match(/BlackBerry/i) ||
  navigator.userAgent.match(/Windows Phone/i)
) {
  gerät = "Handy"
  console.log("Handy");
} else {
  gerät = "PC"
  console.log("PC");
}

</script>
